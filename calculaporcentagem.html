<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Diferença e Porcentagem</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    .container {
        max-width: 400px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    input[type="number"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    #result {
        margin-top: 20px;
    }
    canvas {
        margin-top: 20px;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Calculadora de Diferença e Porcentagem</h2>
    <label for="total">Valor Total:</label>
    <input type="number" id="total" placeholder="Insira o valor total" oninput="calcular()">

    <label for="menor">Valor Menor:</label>
    <input type="number" id="menor" placeholder="Insira o valor menor" oninput="calcular()">

    <div id="result"></div>
    
    <canvas id="pieChart" width="400" height="400"></canvas>
</div>

<script>
    function formatCurrency(amount) {
        return '$' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    }

    function calcular() {
        var total = parseFloat(document.getElementById('total').value);
        var menor = parseFloat(document.getElementById('menor').value);

        var diferenca = total - menor;
        var porcentagemMenor = (menor / total) * 100;
        var porcentagemDiferenca = (diferenca / total) * 100;

        document.getElementById('result').innerHTML = `
            <p>Valor Total: ${formatCurrency(total)}</p>
            <p>Valor Menor: ${formatCurrency(menor)}</p>
            <p>Porcentagem do valor menor em relação ao valor total: ${porcentagemMenor.toFixed(2)}%</p>
            <p>Diferença entre o valor total e o valor menor: ${formatCurrency(diferenca)}</p>
            <p>Porcentagem da diferença em relação ao valor total: ${porcentagemDiferenca.toFixed(2)}%</p>
        `;

        updatePieChart(menor, diferenca);
    }

    function updatePieChart(menor, diferenca) {
        var ctx = document.getElementById('pieChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Menor Valor', 'Diferença'],
                datasets: [{
                    label: 'Valores',
                    backgroundColor: ['#007bff', '#28a745'],
                    data: [menor, diferenca],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            var dataset = data.datasets[tooltipItem.datasetIndex];
                            var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
                                return previousValue + currentValue;
                            });
                            var currentValue = dataset.data[tooltipItem.index];
                            var percentage = Math.round((currentValue / total) * 100);
                            return formatCurrency(currentValue) + ' (' + percentage + '%)';
                        }
                    }
                }
            }
        });
    }
</script>

</body>
</html>
